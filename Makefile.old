# Convenience Makefile
.PHONY: up-dev down-dev logs-dev up-prod down-prod logs-prod build-dev build-prod test typecheck lint

up-dev:
	docker compose -f dev/docker-compose.yml --env-file .env up -d --build

down-dev:
	docker compose -f dev/docker-compose.yml --env-file .env down

logs-dev:
	docker compose -f dev/docker-compose.yml --env-file .env logs -f --tail=200

up-prod:
	docker compose -f prod/docker-compose.yml --env-file .env up -d --build

down-prod:
	docker compose -f prod/docker-compose.yml --env-file .env down

logs-prod:
	docker compose -f prod/docker-compose.yml --env-file .env logs -f --tail=200

test:
	docker compose -f dev/docker-compose.yml --env-file .env exec -T web /bin/sh -lc 'export DJANGO_SETTINGS_MODULE=project.settings; /workspace/.venv/bin/pytest -q; ec=$$?; if [ $$ec -eq 5 ]; then echo "pytest: no tests collected (OK)"; exit 0; else exit $$ec; fi'

typecheck:
	docker compose -f dev/docker-compose.yml exec -T web /workspace/.venv/bin/mypy /app

lint:
	docker compose -f dev/docker-compose.yml exec -T web /workspace/.venv/bin/ruff check /app
